/*!
 * PSPDFKit for Web 2021.4.2 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.webpackJsonpPSPDFKit=window.webpackJsonpPSPDFKit||[]).push([[59],{872:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(18),a=n.n(r),i=n(7),s=n.n(i),o=n(17),c=n.n(o),u=n(1),l=n.n(u),h=n(8),d=n.n(h),f=n(6),p=n(2),m=n(3),v=n(27),g=function(){function e(){s()(this,e),l()(this,"cachedAPStreams",Object(f.b)()),l()(this,"pageAPStreamsPromises",Object(f.b)()),l()(this,"annotationAPStreamPromises",Object(f.b)())}return c()(e,[{key:"cachedRenderAnnotation",value:function(e,t,n,r){var i,s=this,o=this.provider;Object(m.k)(o instanceof o.constructor,"Backend can only use backend annotation provider");var c=e instanceof p.fb?null===(i=o._readStateCallbacks)||void 0===i?void 0:i.getFormFieldByName(e.formFieldName):null,u=!c||c instanceof p.N?null:new p.s({name:c.name,value:void 0!==c.formattedValue?c.formattedValue:"string"==typeof c.value?c.value:c.values});if(!Object(v.t)(e,c))return this.renderAnnotation(e,u,t,n,r);var l=!1,h=function(){l=!0};return{promise:new Promise(function(){var i=a()(d.a.mark((function a(i,o){var c,f,p,m,v,g,b,y,w,P,k;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=function(t){var n=s.annotationAPStreamPromises.get(e.id);n&&(s.annotationAPStreamPromises=s.annotationAPStreamPromises.delete(e.id),n(t))},f=s.annotationAPStreamPromises.get(e.id),s.annotationAPStreamPromises=s.annotationAPStreamPromises.set(e.id,i),f&&f(null),a.prev=4,p=s.pageAPStreamsPromises.get(e.pageIndex)){a.next=15;break}return m=new Promise((function(t){s.annotationAPStreamPromises=s.annotationAPStreamPromises.set(e.id,t)})),a.next=10,m;case 10:return v=a.sent,i(v),a.abrupt("return");case 15:return a.next=17,p;case 17:if(!(g=s.cachedAPStreams.get(e.pageIndex))){a.next=23;break}if(!(b=g?g.get(e.id):null)){a.next=23;break}return c(b),a.abrupt("return");case 23:if(y=s.renderAnnotation(e,u,t,n,r),w=y.promise,P=y.cancel,!l){a.next=28;break}c(null),a.next=34;break;case 28:return h=P,a.next=31,w;case 31:k=a.sent,c(k),k&&s.cacheAPStream(k,e);case 34:a.next=39;break;case 36:a.prev=36,a.t0=a.catch(4),o(a.t0);case 39:case"end":return a.stop()}}),a,null,[[4,36]])})));return function(e,t){return i.apply(this,arguments)}}()),cancel:h}}},{key:"cacheAPStream",value:function(e,t){var n=this.cachedAPStreams.get(t.pageIndex);n||(this.cachedAPStreams=this.cachedAPStreams.set(t.pageIndex,Object(f.b)()),n=this.cachedAPStreams.get(t.pageIndex)),Object(m.k)(n);var r=n.get(t.id);r&&r.release(),this.cachedAPStreams=this.cachedAPStreams.setIn([t.pageIndex,t.id],e)}},{key:"clearAllPageAPStreams",value:function(e){var t=this.cachedAPStreams.get(e);t&&(t.forEach((function(e){return e.release()})),this.cachedAPStreams=this.cachedAPStreams.delete(e)),this.pageAPStreamsPromises=this.pageAPStreamsPromises.delete(e)}},{key:"clearPageAPStreams",value:function(e,t){var n=this.cachedAPStreams.get(e);n&&(n.filter((function(e,n){return t.has(n)})).forEach((function(e){return e.release()})),this.cachedAPStreams=this.cachedAPStreams.updateIn([e],(function(e){return e.filter((function(e,n){return!t.has(n)}))})))}}]),e}()},873:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(170),a=n(6),i=n(3),s=n(326);function o(e){return Object(i.k)(Array.isArray(e),"Wrong `json` field"),Object(a.a)(e.map((function(e){return Object(i.k)("number"==typeof e.pageIndex,"Wrong `pageIndex` field"),Object(i.k)("string"==typeof e.previewText,"Wrong `previewText` field"),Object(i.k)(Array.isArray(e.rangeInPreview),"Wrong `rangeInPreview` field"),Object(i.k)(Array.isArray(e.rectsOnPage),"Wrong `rectsOnPage` field"),new s.a({pageIndex:e.pageIndex,previewText:e.previewText,locationInPreview:e.rangeInPreview[0],lengthInPreview:e.rangeInPreview[1],rectsOnPage:Object(a.a)(e.rectsOnPage).map((function(e){return Object(r.a)(e)})),isAnnotation:!!e.isAnnotation,annotationRect:e.annotationRect?Object(r.a)(e.annotationRect):null})})).filter(Boolean))}},874:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(25),a=n.n(r),i=n(7),s=n.n(i),o=n(17),c=n.n(o),u=n(6),l=n(15);function h(){return!0}var d=function(){function e(t){s()(this,e),this.queue=Object(u.c)(),this.priorityQueue=Object(u.c)(),this.inFlightRequests=Object(u.b)(),this.inflightRequestLimit=t,this.isDestroyed=!1}return c()(e,[{key:"enqueue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDestroyed)return{promise:new Promise((function(){})),cancel:function(){}};var r=null,a=null,i=new Promise((function(e,t){r=e,a=t})),s=n?this.priorityQueue:this.queue,o=Object(u.j)(s,e,{promise:i,resolve:r,reject:a});return n?this.priorityQueue=o:this.queue=o,n?this.next():setTimeout((function(){return t.next()}),35),{promise:i,cancel:function(){return t._cancel(e)}}}},{key:"_cancel",value:function(e){this.queue.has(e)&&(this.queue=this.queue.delete(e)),this.priorityQueue.has(e)&&(this.priorityQueue=this.priorityQueue.delete(e)),this.inFlightRequests.has(e)&&(this.inFlightRequests=this.inFlightRequests.delete(e))}},{key:"cancelAll",value:function(){this.queue=Object(u.c)(),this.priorityQueue=Object(u.c)(),this.inFlightRequests=Object(u.b)()}},{key:"_requestFinished",value:function(e,t){if(!this.isDestroyed){var n=this.inFlightRequests.get(e);n&&(n.resolve(t),this.inFlightRequests=this.inFlightRequests.delete(e)),this.next()}}},{key:"_requestFailed",value:function(e,t){if(!this.isDestroyed){var n=this.inFlightRequests.get(e);n&&(n.reject(t),this.inFlightRequests=this.inFlightRequests.delete(e)),this.next()}}},{key:"next",value:function(){var e=this;if(!(this.isDestroyed||this.inFlightRequests.size>=this.inflightRequestLimit)){if(this.priorityQueue.size>=1){var t=this.priorityQueue.findLastEntry(h);Object(l.a)(t);var n=a()(t,2),r=n[0],i=n[1];return this.priorityQueue=this.priorityQueue.delete(r),this.inFlightRequests=this.inFlightRequests.set(r,i),void r.request().then((function(t){return e._requestFinished(r,t)})).catch((function(t){return e._requestFailed(r,t)}))}if(this.queue.size>=1){var s=this.queue.findEntry(h);Object(l.a)(s);var o=a()(s,2),c=o[0],u=o[1];this.queue=this.queue.delete(c),this.inFlightRequests=this.inFlightRequests.set(c,u),c.request().then((function(t){return e._requestFinished(c,t)})).catch((function(t){return e._requestFailed(c,t)}))}}}},{key:"destroy",value:function(){this.isDestroyed=!0}}]),e}()},875:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n.n(r);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n,r,i,o){var c;return e.has(n)?c=e.get(n):(t[c=i.toString()]=n,e.set(n,c)),s(s({},r),{},a()({},o,c))}},876:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={clientsPresenceEnabled:!0,listenToServerChangesEnabled:!0}},959:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return oe}));var r=n(89),a=n.n(r),i=n(18),s=n.n(i),o=n(36),c=n.n(o),u=n(7),l=n.n(u),h=n(17),d=n.n(h),f=n(4),p=n.n(f),m=n(11),v=n.n(m),g=n(12),b=n.n(g),y=n(5),w=n.n(y),P=n(1),k=n.n(P),S=n(8),_=n.n(S),x=n(3);function O(e,t,n){return j.apply(this,arguments)}function j(){return(j=s()(_.a.mark((function e(t,n,r){var a;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t,"/auth"),{method:"POST",headers:{"Content-Type":"application/json","PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(4,", client=").concat("2021.4.2",", client-git=").concat("12fc65bf3a")},body:JSON.stringify({jwt:n.jwt,origin:window.location.href,password:r}),credentials:"include"});case 2:if(!(a=e.sent).ok){e.next=7;break}return e.abrupt("return",a.json());case 7:return e.abrupt("return",a.text().then((function(e){throw"INVALID_PASSWORD"===e?new x.a(e):new x.a("An error occurred while connecting to PSPDFKit Server: ".concat(e||a.statusText))})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=n(2),A=n(403),F=n(187),q=n(27),I=n(227),D=n(6),T=n(14),E=n(873),U=n(170),L=n(54),C=n(339);function N(e){var t="The supplied JWT is invalid. Please refer to our guides on how to set up authentication:\n  https://pspdfkit.com/guides/web/current/server-backed/client-authentication/";if(-1===e.indexOf('{"internal":')){var n;Object(x.k)("string"==typeof e&&3===e.split(".").length,t);try{var r=C.Base64.decode(e.split(".")[1]);n=JSON.parse(r)}catch(e){throw new x.a(t)}Object(x.k)("string"==typeof n.document_id,"The supplied JWT is invalid. The field 'document_id' has to be a string value.\n  Please refer to our guides for further information: https://pspdfkit.com/guides/web/current/server-backed/client-authentication/")}}var J=n(456),H=n(874),Q=n(169);function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var a=w()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return b()(this,n)}}var B=function(e){v()(n,e);var t=W(n);function n(){return l()(this,n),t.apply(this,arguments)}return n}(D.e({authPayload:null,serverUrl:null,documentId:null,backendPermissions:null,documentURL:null,imageToken:null,instantSettings:null,token:null,features:Object(D.a)(),signatureFeatureAvailability:Q.a.NONE,isFormsEnabled:!0,minSearchQueryLength:1,documentHandle:null,isDocumentHandleOutdated:!1,digitalSignatures:null,defaultGroup:void 0,hasCollaborationPermissions:!1,forceLegacySignaturesFeature:!1})),K=n(258),G=n(158),V=n(298),z="The image can not be rendered because of an unknown error.",M=function(){function e(t){var n=t.identifier,r=t.url,a=t.token,i=t.payload,s=t.doNotRequestWebP,o=void 0!==s&&s;l()(this,e),this.identifier=n,this.url=r,this.token=a,this.payload=i,this.doNotRequestWebP=o}return d()(e,[{key:"abort",value:function(){this.httpRequest&&this.httpRequest.abort()}},{key:"request",value:function(){var e=this;return new Promise((function(t,n){var r=new XMLHttpRequest;e.httpRequest=r,r.open(e.payload?"POST":"GET",e.url,!0),r.setRequestHeader("X-PSPDFKit-Image-Token",e.token),G.c&&!e.doNotRequestWebP&&r.setRequestHeader("Accept","image/webp,*/*"),r.responseType="blob",r.onreadystatechange=s()(_.a.mark((function e(){var a,i,s,o,c;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(4===r.readyState){e.next=2;break}return e.abrupt("return");case 2:if(!r.response||!r.response.type.startsWith("application/json")){e.next=8;break}return(a=new FileReader).onload=function(e){var r,a=JSON.parse(null===(r=e.target)||void 0===r?void 0:r.result);a.attachments_not_found?t({attachmentsNotFound:a.attachments_not_found}):a.error?n(new x.a("The server could not render the requested image (".concat(a.error,")"))):n(new x.a(z))},a.onerror=function(){return n(new x.a(z))},a.readAsText(r.response),e.abrupt("return");case 8:if(Object(K.a)(r.status)){e.next=11;break}return n(new x.a(z)),e.abrupt("return");case 11:return i=r.response,s=URL.createObjectURL(i),(o=new Image).onerror=function(){return n(new x.a(z))},o.src=s,c="function"==typeof o.decode?o.decode():new Promise((function(e){return setTimeout(e,200)})),e.next=19,c;case 19:t(new V.a(o,(function(){return URL.revokeObjectURL(s)})));case 20:case"end":return e.stop()}}),e)}))).bind(e),r.send(e.payload)}))}}]),e}(),X=n(98),Y=n(875),Z=n(876),$=n(388),ee=n(189),te=n(872),ne=n(15),re=["color","fillColor","outlineColor"];function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){k()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var a=w()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return b()(this,n)}}var oe=function(e){v()(K,e);var t,r,i,o,u,h,f,m,g,b,y,w,P,S,j,C,W=se(K);function K(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;l()(this,K),t=W.call(this),k()(p()(t),"_password",null),k()(p()(t),"type","SERVER"),k()(p()(t),"_requestRenderAnnotation",(function(e,n,r,a,i,s){var o,c,u="".concat(t._state.documentURL,"/render_annotation"),l="render-annotation-".concat(s?Object(X.a)():e.id),h=JSON.stringify({data:Object(L.o)(e),width:a,height:i,detached:s||void 0,formFieldValue:n?Object(L.s)(n):void 0}),d=!1,f=[],p=new Promise((function(e,t){o=e,c=t}));return function n(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],p=new FormData;p.append("render",h),s.length>0&&e.imageAttachmentId&&r&&r.data&&p.append(e.imageAttachmentId,r.data);var m=new M({identifier:l,url:u,token:t._state.imageToken,payload:p,doNotRequestWebP:a>T.E||i>T.E}),v=t._requestQueue.enqueue(m,!1);v.promise.then((function(e){d||(e.attachmentsNotFound?n(e.attachmentsNotFound):e.attachmentsNotFound?c(new x.a("Attachment could not be found.")):o(e))})).catch((function(e){d||c(e)})),f.push(v)}(),{promise:p,cancel:function(){d=!0,f.forEach((function(e){return e.cancel()}))}}})),k()(p()(t),"handleDocumentHandleConflict",(function(){t._state=t._state.set("isDocumentHandleOutdated",!0),t.cancelRequests(),t._destroyProvider()}));var r=e.serverUrl||Object(F.a)(n.document);if("/"!==r.substr(-1))throw new x.a("`serverUrl` must have a slash at the end (e.g. `https://pspdfkit.example.com/`).");if(!e.serverUrl){var a="".concat(n.location.protocol,"//").concat(n.location.host,"/");if(r===a)throw new x.a('PSPDFKit automatically infers the URL of PSPDFKit Server from the current `<script>` tag.\nIn the current case, this URL is set to the same as the current browser\'s location.\nThis can happen when you bundle pspdfkit.js with your custom JavaScript for example.\n\nTo make sure everything works as expected, please set the `serverUrl` to the URL of PSPDFKit Server:\n\nPSPDFKit.load({\n  serverUrl: "https://pspdfkit-server.example.com/",\n  ...,\n});')}if("string"!=typeof e.documentId)throw new x.a("`documentId` must be of type string.");if("object"!==c()(e.authPayload)||"string"!=typeof e.authPayload.jwt)throw new x.a("authPayload must be an object that contains the `jwt`. For example: `authPayload: { jwt: 'xxx.xxx.xxx'}`");N(e.authPayload.jwt),he(e.instant);var i=null;if(e.instant)if(Object(x.l)(e.instant)){var s=e.instant;i={clientsPresenceEnabled:!1!==s.clientsPresenceEnabled,listenToServerChangesEnabled:!1!==s.listenToServerChangesEnabled}}else i=Z.a;t._requestQueue=new H.a(T.C);var o=!!e.electronicSignatures&&Boolean(e.electronicSignatures.forceLegacySignaturesFeature);return t._state=new B({serverUrl:r,documentId:e.documentId,instantSettings:i,documentURL:"".concat(r,"i/d/").concat(e.documentId),authPayload:e.authPayload,isFormsEnabled:!e.disableForms,forceLegacySignaturesFeature:o}),e.trustedCAsCallback&&Object(x.p)("PSPDFKit.Configuration#trustedCAsCallback is only used on Standalone deployments. On a Server-backed deployment, please follow the instructions at https://pspdfkit.com/guides/web"),t}return d()(K,[{key:"isUsingInstantProvider",value:function(){return null!=this._state.instantSettings}},{key:"hasClientsPresence",value:function(){var e=this._state.instantSettings;return null!=e&&!1!==e.clientsPresenceEnabled}},{key:"load",value:(C=s()(_.a.mark((function e(){var t,n,r,a,i,s,o,c,u,l,h,d,f,p,m,v,g=this,b=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.length>0&&void 0!==b[0]?b[0]:{},e.next=3,O("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),this._state.authPayload,t.password);case 3:if(n=e.sent,r=n.imageToken,a=n.token,i=n.permissions,s=n.features,o=n.signatureFeatureAvailability,c=n.hasPassword,u=n.minSearchQueryLength,l=n.layerHandle,h=n.allowedTileScales,d=n.digitalSignatures,f=n.defaultGroup,p=n.collaborationPermissions,m=n.creatorName,this._password=t.password,!this._state.instantSettings||s.includes(R.z.INSTANT)){e.next=20;break}throw new x.a("Instant feature is not enabled on this server. Please set `instant` to `false`.\n\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/");case 20:if(v=o===Q.a.ELECTRONIC_SIGNATURES&&s.includes(R.z.WEB_ANNOTATION_EDITING)&&this._state.forceLegacySignaturesFeature?Q.a.LEGACY_SIGNATURES:o,this._state=this._state.withMutations((function(e){return e.set("imageToken",r).set("token",a).set("features",Object(D.a)(s)).set("signatureFeatureAvailability",v).set("backendPermissions",new R.c({readOnly:-1===i.indexOf("write"),downloadingAllowed:i.indexOf("download")>=0})).set("documentURL","".concat(g._state.serverUrl,"i/d/").concat(g._state.documentId,"/h/").concat(l)).set("documentHandle",l).set("isDocumentHandleOutdated",!1).set("digitalSignatures",Object(L.g)(d))})),!p||this._state.instantSettings){e.next=24;break}throw new x.a("Collaboration Permissions is not supported when `instant` is disabled. Please make sure `configuration#instant` is set to `true`.");case 24:return this._state=this._state.withMutations((function(e){e.defaultGroup=f,e.hasCollaborationPermissions=Boolean(p)})),this.provider&&this.provider.destroy(),e.next=28,this._initProvider();case 28:return this.provider=e.sent,this._state.instantSettings&&this.provider.setDocumentHandleConflictCallback(this.handleDocumentHandleConflict),e.abrupt("return",{features:this._state.features,signatureFeatureAvailability:this._state.signatureFeatureAvailability,hasPassword:c,minSearchQueryLength:u,allowedTileScales:h,jsActionChanges:[],creatorName:m,defaultGroup:f});case 31:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"_initProvider",value:(j=s()(_.a.mark((function e(){var t,r,a,i,s,o;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._state.instantSettings){e.next=9;break}return t="".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId,"/h/").concat(this._state.documentHandle),e.next=4,n.e(60).then(n.bind(null,957));case 4:return r=e.sent,a=r.InstantProvider,e.abrupt("return",new a("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),t,{auth_token:this._state.token},this._state.instantSettings));case 9:return i=this._state.isFormsEnabled&&this._state.features.includes(R.z.FORMS),e.next=12,n.e(61).then(n.bind(null,960));case 12:return s=e.sent,o=s.RESTProvider,e.abrupt("return",new o(this._state.documentURL,{token:this._state.token},{isFormsEnabled:i}));case 15:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"destroy",value:function(){this._destroyProvider(),this._requestQueue&&this._requestQueue.destroy()}},{key:"documentInfo",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.json")).then((function(e){return e.json()})).then((function(e){return e.data.totalPages=e.data.pageCount,e.data}))}},{key:"getFormJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/form.json")).then((function(e){return 403===e.status?{v:1,type:"pspdfkit/form",annotations:[],fields:[]}:e.json().then((function(e){return e.data}))}))}},{key:"evalFormValuesActions",value:(S=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(){return S.apply(this,arguments)})},{key:"evalScript",value:(P=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(){return P.apply(this,arguments)})},{key:"permissions",value:function(){return Promise.resolve(this._state.backendPermissions)}},{key:"getDefaultGroup",value:function(){return this._state.defaultGroup}},{key:"isCollaborationPermissionsEnabled",value:function(){return this._state.hasCollaborationPermissions}},{key:"textForPageIndex",value:function(e){var t="".concat(this._state.documentURL,"/page-").concat(e,"-text"),n=new(this._getJSONRequestHandler())(t,this._state.token),r=this._requestQueue.enqueue(n,!0);return{promise:r.promise.then((function(t){return Object(I.b)(t,e)})),cancel:function(){r.cancel()}}}},{key:"getTextFromRects",value:function(e,t){var n=encodeURIComponent(JSON.stringify(t.map(U.b).toArray()));return this._fetch("".concat(this._state.documentURL,"/page-").concat(e,"-highlighted?rects=").concat(n)).then((function(e){return e.json()})).then((function(e){return e.text}))}},{key:"_getJSONRequestHandler",value:function(){return J.a}},{key:"renderTile",value:function(e,t,n,r,a){var i=this;if(this._state.isDocumentHandleOutdated)return{promise:new Promise((function(){})),cancel:function(){}};var s,o,c="".concat(this._state.documentURL,"/page-").concat(e,"-dimensions-").concat(t.width,"-").concat(t.height,"-tile-").concat(n.left,"-").concat(n.top,"-").concat(n.width,"-").concat(n.height).concat(r?"-print":""),u=t.width===n.width&&t.height===n.height,l=n.width>T.E||n.height>T.E,h=!1,d=!1,f=[],p=[],m=new Promise((function(e,t){s=e,o=t}));return function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(a){var r=new FormData;r.append("data",JSON.stringify({annotations:a.annotations.filter(q.u).map(L.o).toJS().map((function(e){return{content:e}})),formFieldValues:a.formFieldValues.map(L.s).toJS(),formFields:a.formFields.map(L.r).toJS(),signatures:a.signatures||[]})),n.length>0&&n.forEach((function(e){var t=a.attachments.get(e);Object(ne.a)(t&&t.data,"Attachment data could not be found."),r.append(e,t.data)})),t=new M({identifier:c,url:c,token:i._state.imageToken,payload:r,doNotRequestWebP:l})}else t=new M({identifier:c,url:c,token:i._state.imageToken,doNotRequestWebP:l});p.push(t);var m=i._requestQueue.enqueue(t,u);m.promise.then((function(t){if(!h)return t.attachmentsNotFound&&!d?(d=!0,void e(t.attachmentsNotFound)):void(t.attachmentsNotFound?o(new x.a("Attachment could not be found.")):s(t))})).catch((function(e){h||o(e)})),f.push(m)}(),{promise:m,cancel:function(){h=!0,p.forEach((function(e){e.abort&&"function"==typeof e.abort&&e.abort()})),f.forEach((function(e){return e.cancel()}))}}}},{key:"renderAnnotation",value:function(e,t,n,r,a){return this._requestRenderAnnotation(e,t,n,r,a)}},{key:"renderPageAnnotations",value:function(e){var t=Promise.resolve();return this.pageAPStreamsPromises=this.pageAPStreamsPromises.set(e,t),t}},{key:"renderDetachedAnnotation",value:function(e,t,n,r){return this._requestRenderAnnotation(e,null,t,n,r,!0)}},{key:"getAttachment",value:(w=s()(_.a.mark((function e(t){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._fetch("".concat(this._state.documentURL,"/attachments/").concat(t));case 3:n=e.sent,e.t0=n.status,e.next=404===e.t0?7:200===e.t0?8:11;break;case 7:throw new x.a("Attachment not Found.");case 8:return e.next=10,n.blob();case 10:return e.abrupt("return",e.sent);case 11:throw new x.a("Bad Request.");case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(0),new x.a("Could not fetch attachment from PSPDFKit Server. ".concat(e.t1));case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return w.apply(this,arguments)})},{key:"search",value:(y=s()(_.a.mark((function e(t,n,r,a){var i,s,o,c,u,l=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>4&&void 0!==l[4]&&l[4],s=l.length>5&&void 0!==l[5]?l[5]:ee.a.TEXT,o="q=".concat(s===ee.a.PRESET?t.replace(/_/g,"-"):encodeURIComponent(t),"&start=").concat(n,"&limit=").concat(r,"&type=").concat(s,"&include_annotations=").concat(i.toString(),"&case_sensitive=").concat(a.toString()),c="".concat(this._state.documentURL,"/search?").concat(o),e.next=6,new J.a(c,this._state.token).request();case 6:return u=e.sent,e.abrupt("return",Object(E.a)(u.data));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return y.apply(this,arguments)})},{key:"searchAndRedact",value:(b=s()(_.a.mark((function e(t,n){var r,i,s,o,c,u,l,h,d,f,p,m;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.searchType,s=n.annotationPreset,o=n.searchInAnnotations,c=n.caseSensitive,u=s.color,l=s.fillColor,h=s.outlineColor,d=a()(s,re),e.next=4,this._fetch("".concat(this._state.documentURL,"/redactions"),{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:i,strategyOptions:(r={},k()(r,i,i===ee.a.PRESET?t.replace(/_/g,"-"):t),k()(r,"includeAnnotations",o),k()(r,"caseSensitive",c),r),content:ie(ie({},d),{},{color:u&&u.toHex(),fillColor:l&&l.toHex(),outlineColor:h&&h.toHex()})})});case 4:return f=e.sent,e.next=7,f.json();case 7:return p=e.sent,m=p.data,e.abrupt("return",Object(D.a)(m&&m.annotations?m.annotations.map((function(e){return $.a.fromJSON(e.id,e.content)})):[]));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"exportPDF",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.flatten,n=void 0!==t&&t,r=e.includeComments,a=void 0===r||r,i="".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=").concat(String(n),"&comments=").concat(String(a),"&render_ap_streams=").concat(String(!n));return fetch(i,{method:"GET",credentials:"include"}).then((function(e){return e.arrayBuffer()}))}},{key:"exportXFDF",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.xfdf")).then((function(e){return e.text()}))}},{key:"exportInstantJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/instant.json")).then((function(e){return e.json()}))}},{key:"getPDFURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeComments,n=void 0===t||t;return{promise:Promise.resolve("".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=true&comments=").concat(String(n))),revoke:function(){}}}},{key:"generatePDFObjectURL",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.includeComments,a=void 0===r||r,i=!1,s=new Promise((function(n){t.exportPDF({flatten:!0,includeComments:a}).then((function(t){if(!i){var r=new Blob([t],{type:"application/pdf"});e=window.URL.createObjectURL(r),n(e)}}))}));return{promise:s,revoke:function(){e&&window.URL.revokeObjectURL(e),i=!0}}}},{key:"getDocumentOutline",value:(g=s()(_.a.mark((function e(){var t,n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._fetch("".concat(this._state.documentURL,"/outline.json")).then((function(e){return e.json()}));case 3:n=e.sent,t=n.data,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t={};case 10:return r=Array.isArray(t.outline)?t.outline:[],e.abrupt("return",Object(D.a)(r.map(A.a)));case 12:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return g.apply(this,arguments)})},{key:"onKeystrokeEvent",value:function(){throw new Error("not implemented")}},{key:"applyOperationsAndReload",value:(m=s()(_.a.mark((function e(t){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue(t);case 3:return n=e.sent,this._destroyProvider(),e.next=7,this._fetch("".concat(this._state.documentURL,"/apply-operations"),{method:"post",body:n,credentials:"include"});case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new x.a("Applying operations failed: ".concat(e.t0));case 12:return e.abrupt("return",this.reloadDocument());case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return m.apply(this,arguments)})},{key:"applyRedactionsAndReload",value:(f=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._destroyProvider(),e.next=4,this._fetch("".concat(this._state.documentURL,"/redact"),{method:"post",credentials:"include"});case 4:return e.abrupt("return",this.reloadDocument());case 7:throw e.prev=7,e.t0=e.catch(0),this.provider.load(),new x.a("Applying redactions failed: ".concat(e.t0));case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return f.apply(this,arguments)})},{key:"reloadDocument",value:(h=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.load({password:this._password});case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),new x.a("Reloading the document failed: ".concat(e.t0));case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return h.apply(this,arguments)})},{key:"exportPDFWithOperations",value:(u=s()(_.a.mark((function e(t){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue(t);case 3:return n=e.sent,e.abrupt("return",this._fetch("".concat(this._state.documentURL,"/pdf-with-operations"),{method:"post",body:n,credentials:"include"}).then((function(e){return e.arrayBuffer()})));case 7:throw e.prev=7,e.t0=e.catch(0),new x.a("Exporting PDF with operations failed: ".concat(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return u.apply(this,arguments)})},{key:"getSignaturesInfo",value:(o=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._refreshSignaturesInfoPromise){e.next=3;break}return e.next=3,this._refreshSignaturesInfoPromise;case 3:return e.abrupt("return",this._state.digitalSignatures);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"refreshSignaturesInfo",value:function(){var e=this;return this._refreshSignaturesInfoPromise||(this._refreshSignaturesInfoPromise=new Promise((function(t,n){e._fetch("".concat(e._state.documentURL,"/signatures"),{method:"get",credentials:"include"}).then((function(e){return e.json()})).then((function(n){var r=n.data;e._state=e._state.set("digitalSignatures",Object(L.g)(r)),e._refreshSignaturesInfoPromise=null,t()})).catch((function(t){e._state=e._state.set("digitalSignatures",null),e._refreshSignaturesInfoPromise=null,n(t)}))}))),this._refreshSignaturesInfoPromise}},{key:"signDocumentAndReload",value:(i=s()(_.a.mark((function e(t,n){var r,a;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===n||"object"===c()(n)){e.next=3;break}throw new x.a("Signing service data must be an object if specified.");case 3:return r={},t&&"placeholderSize"in t&&(r.signerDataSource={estimatedSize:t.placeholderSize}),t&&"flatten"in t&&(r.flatten=t.flatten),a=ie(ie({},n?{signingToken:n.signingToken}:null),r),this._destroyProvider(),e.next=10,this._fetch("".concat(this._state.documentURL,"/sign"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});case 10:return e.next=12,this.reloadDocument();case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),this.provider.load(),new x.a("Adding digital signature failed: ".concat(e.t0.message||e.t0));case 18:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e,t){return i.apply(this,arguments)})},{key:"getDocumentHandle",value:function(){return this._state.documentHandle}},{key:"cancelRequests",value:function(){this._requestQueue.cancelAll()}},{key:"_destroyProvider",value:function(){this.provider&&(this.provider._clients&&this.provider._clients.disconnect(),this.provider.destroy())}},{key:"_fetch",value:(r=s()(_.a.mark((function e(t,n){var r,a,i;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,ie(ie({},n),{},{headers:ie(ie({},null==n?void 0:n.headers),{},{"X-PSPDFKit-Token":this._state.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(4,", client=").concat("2021.4.2",", client-git=").concat("12fc65bf3a")})}));case 2:if((r=e.sent).ok){e.next=10;break}return e.next=6,ce(r);case 6:throw a=e.sent,a="object"===c()(a)?a.reason:a,i=a||"".concat(r.status," ").concat(r.statusText),new x.a(i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"syncChanges",value:function(){return this.provider.syncChanges()}},{key:"clearAPStreamCache",value:(t=s()(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),K}(te.a);function ce(e){return e.clone().json().catch((function(){return e.text()}))}function ue(e){return le.apply(this,arguments)}function le(){return(le=s()(_.a.mark((function e(t){var n,r,a,i,o;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r=new WeakMap,e.next=4,Promise.all(t.map(function(){var e=s()(_.a.mark((function e(t,a){var i,s,o,u,l,h;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("importDocument"!==t.type){e.next=6;break}return i=t.document,Object(ne.a)(i instanceof File||i instanceof Blob,"Wrong `importDocument` operation `document` value: it must be a File or a Blob"),e.abrupt("return",Object(Y.a)(r,n,i,t,a,"document"));case 6:if("applyInstantJson"!==t.type){e.next=14;break}return s=t.instantJson,Object(ne.a)("object"===c()(s)&&null!==s,"Wrong `applyInstantJson` operation `instantJson` value: it must be an object"),o=JSON.stringify(s),u=new Blob([o],{type:"application/json"}),e.abrupt("return",Object(Y.a)(r,n,u,t,a,"dataFilePath"));case 14:if("applyXfdf"!==t.type){e.next=19;break}return l=t.xfdf,Object(ne.a)("string"==typeof l,"Wrong `applyXfdf` operation `xfdf` value: it must be a string"),h=new Blob([l],{type:"application/vnd.adobe.xfdf"}),e.abrupt("return",Object(Y.a)(r,n,h,t,a,"dataFilePath"));case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 4:for(o in a=e.sent,(i=new FormData).append("operations",JSON.stringify({operations:a})),n)i.append(o,n[o]);return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){var t="";if("boolean"!=typeof e&&(Object(x.l)(e)?(e.hasOwnProperty("clientsPresenceEnabled")&&"boolean"!=typeof e.clientsPresenceEnabled&&(t+="`clientsPresenceEnabled` in instance settings is not valid. Must be `true` or `false`.\n"),e.hasOwnProperty("listenToServerChangesEnabled")&&"boolean"!=typeof e.listenToServerChangesEnabled&&(t+="`listenToServerChangesEnabled` in instance settings is not valid. Must be `true` or `false`.\n")):t="`instant` flag must either be set to `true` or `false`\n",t))throw new x.a("".concat(t,"\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/"))}}}]);