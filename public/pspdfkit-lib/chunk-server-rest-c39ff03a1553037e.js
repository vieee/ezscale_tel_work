/*!
 * PSPDFKit for Web 2021.4.2 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.webpackJsonpPSPDFKit=window.webpackJsonpPSPDFKit||[]).push([[61],{960:function(e,t,n){"use strict";n.r(t),n.d(t,"RESTProvider",(function(){return A}));var a=n(36),r=n.n(a),o=n(89),s=n.n(o),i=n(18),c=n.n(i),u=n(7),l=n.n(u),d=n(17),f=n.n(d),h=n(1),p=n.n(h),k=n(8),m=n.n(k),b=n(6),v=n(3),y=n(54),w=n(161),j=n(11),O=n.n(j),F=n(12),P=n.n(F),x=n(5),g=n.n(x);function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=g()(e);if(t){var r=g()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return P()(this,n)}}var L=function(e){O()(n,e);var t=_(n);function n(){return l()(this,n),t.apply(this,arguments)}return n}(b.e({alreadyLoadedPages:Object(b.b)(),serverURL:null,authPayload:null,isLoaded:!1,isFormsEnabled:!0,loadBookmarksPromise:null,ignoredFormFieldNames:null})),S=n(223),E=n(297),C=n(15),B=["id"],D=["id"],V=["id"],T=["id"];function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var A=function(){function e(t,n,a){var r=a.isFormsEnabled;l()(this,e),p()(this,"canCreateBackendOrphanWidgets",!0),p()(this,"setDocumentHandleConflictCallback",(function(){})),this.state=new L({serverURL:t,authPayload:n,isFormsEnabled:r})}var t,n,a,o,i,u,d,h,k,j,O,F,P,x;return f()(e,[{key:"load",value:(x=c()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=this.state.set("isLoaded",!0),!this.state.isFormsEnabled){e.next=4;break}return e.next=4,this._initializeFormFieldValues();case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"setReadStateCallbacks",value:function(e){this._readStateCallbacks=e}},{key:"setAnnotationCallbacks",value:function(e){this.annotationCallbacks=e}},{key:"setBookmarkCallbacks",value:function(e){this.bookmarkCallbacks=e}},{key:"setFormFieldValueCallbacks",value:function(e){this.formFieldValueCallbacks=e}},{key:"createAnnotation",value:(P=c()(m.a.mark((function e(t,n){var a,r,o,i,c=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),a=Object(y.o)(t),r=a.id,o=s()(a,B),i={id:r,content:o},e.next=5,this._request("/annotations","POST",i).then((function(e){if(200!==e.status)throw new v.a("PSPDFKit Server returned an error, when saving an annotation.");e.json().then((function(e){if("attachment_missing"===e.error){var t=R(i,n);return c._request("/annotations","POST",t).then((function(e){return e.json()}))}return e}))}));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"updateAnnotation",value:(F=c()(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),n=Object(y.o)(t),a=n.id,r=s()(n,D),e.next=4,this._request("/annotations/".concat(a),"PUT",{id:a,content:r});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"deleteAnnotation",value:(O=c()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this._request("/annotations/".concat(t.id),"DELETE");case 3:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"createBookmark",value:(j=c()(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return n=Object(w.b)(t),a=n.id,r=s()(n,V),e.next=6,this._request("/bookmarks","POST",{id:a,content:r});case 6:if(200===e.sent.status){e.next=9;break}throw new v.a("PSPDFKit Server returned an error, when saving an bookmark.");case 9:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"updateBookmark",value:(k=c()(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return n=Object(w.b)(t),a=n.id,r=s()(n,T),e.next=6,this._request("/bookmarks/".concat(a),"PUT",{id:a,content:r});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"deleteBookmark",value:(h=c()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return e.next=5,this._request("/bookmarks/".concat(t),"DELETE");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"setFormFieldValue",value:(d=c()(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),n={id:Object(S.b)(t),content:Object(y.s)(t)},e.next=4,this._request("/form-field-values","POST",{formFieldValues:[n]});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"createFormFieldValue",value:(u=c()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"deleteFormFieldValue",value:(i=c()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"loadAnnotationsForPageIndex",value:(o=c()(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._verifyLoaded(),!this.state.alreadyLoadedPages.has(t)){e.next=5;break}return e.next=4,this.state.alreadyLoadedPages.get(t);case 4:return e.abrupt("return");case 5:return e.prev=5,n=this._request("/page-".concat(t,"-annotations"),"GET").then((function(e){return e.json()})).catch((function(e){throw e})),this.state=this.state.setIn(["alreadyLoadedPages",t],n),e.next=10,n;case 10:a=e.sent,this.state=this.state.setIn(["alreadyLoadedPages",t],Promise.resolve()),(r=Object(b.a)().withMutations((function(e){a.annotations.map((function(t){try{e.push(Object(y.c)(t.id,t.content))}catch(e){Object(v.j)("Skipped creating annotation #".concat(t.id," from payload because an error occurred while deserializing."),t.content),Object(v.j)(e)}}))}))).size>0&&(Object(C.a)(this.annotationCallbacks),this.annotationCallbacks.createAnnotations(r,Object(b.b)(),E.a)),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),this._handleError(e.t0,"annotations");case 19:case"end":return e.stop()}}),e,this,[[5,16]])}))),function(e){return o.apply(this,arguments)})},{key:"loadBookmarks",value:(a=c()(m.a.mark((function e(){var t,n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._verifyLoaded(),!this.state.loadBookmarksPromise){e.next=5;break}return e.next=4,this.state.loadBookmarksPromise;case 4:return e.abrupt("return");case 5:return e.prev=5,t=this._request("/bookmarks","GET").then((function(e){return e.json()})).then((function(e){return e.data})).catch((function(e){throw e})),this.state=this.state.set("loadBookmarksPromise",t),e.next=10,t;case 10:n=e.sent,this.state=this.state.set("loadBookmarksPromise",Promise.resolve()),Object(C.a)(Array.isArray(n.bookmarks),"Unexpected reply from bookmarks endpoint."),(a=Object(b.a)().withMutations((function(e){n.bookmarks.forEach((function(t){try{e.push(Object(w.a)(t.id,t.content))}catch(e){Object(v.j)("Skipped creating bookmark #".concat(t.id," from payload because an error occurred while deserializing."),t),Object(v.j)(e)}}))}))).size>0&&(Object(C.a)(this.bookmarkCallbacks),this.bookmarkCallbacks.createBookmarks(a,E.a)),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),this._handleError(e.t0,"bookmarks");case 20:case"end":return e.stop()}}),e,this,[[5,17]])}))),function(){return a.apply(this,arguments)})},{key:"syncChanges",value:(n=c()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"_initializeFormFieldValues",value:(t=c()(m.a.mark((function e(){var t,n,a,r=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._request("/form-field-values","GET");case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,Object(C.a)(Array.isArray(n.formFieldValues),"Unexpected reply from form-values endpoint."),a=Object(b.a)(n.formFieldValues.map((function(e){var t=e.content;try{return Object(y.f)(t)}catch(e){return Object(v.j)("Skipped form field value ".concat(t.name," from payload because an error occurred while deserializing."),t),Object(v.j)(e),null}})).filter(Boolean)),Object(C.a)(this.formFieldValueCallbacks),this.state.ignoredFormFieldNames&&this.state.ignoredFormFieldNames.size?this.formFieldValueCallbacks.setFormFieldValues(a.filter((function(e){var t;return!(null!==(t=r.state.ignoredFormFieldNames)&&void 0!==t&&t.includes(e.name))}))):this.formFieldValueCallbacks.setFormFieldValues(a);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_handleError",value:function(e,t){Object(v.i)("Loading or updating ".concat(t," failed:\n\n").concat(e.message))}},{key:"_request",value:function(e,t,n){Object(C.a)(null!=this.state.authPayload,"Cannot call request without authPayload");var a=n instanceof FormData||"object"!==r()(n)?null:{"Content-Type":"application/json"},o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){p()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({"X-PSPDFKit-Token":this.state.authPayload.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(4,", client=").concat("2021.4.2",", client-git=").concat("12fc65bf3a")},a);return fetch("".concat(this.state.serverURL).concat(e),{method:t,headers:o,body:n instanceof FormData?n:"object"===r()(n)?JSON.stringify(n):void 0,credentials:"include"})}},{key:"_verifyLoaded",value:function(){if(!this.state.isLoaded)throw new Error("not loaded")}},{key:"setIgnoredFormFieldNames",value:function(e){this.state=this.state.set("ignoredFormFieldNames",e)}}]),e}();function R(e,t){var n=new FormData;return n.append("annotation",JSON.stringify(e)),t.forEach((function(e,t){t&&e.data&&n.append(t,e.data)})),n}}}]);